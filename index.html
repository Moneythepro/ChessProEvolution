<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChessProEvolution</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
  <!-- ✅ Lucide Icon Library -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header>
      <h1><i data-lucide="crown"></i> ChessProEvolution</h1>
      <div style="display: flex; gap: 0.5rem;">
        <button id="menuBtn" title="Menu"><i data-lucide="more-horizontal"></i></button>
        <button onclick="toggleTheme()" title="Toggle Theme"><i data-lucide="moon-star"></i></button>
      </div>
    </header>

    <!-- Start Menu -->
    <div id="startMenu">
      <h2>Select Game Mode</h2>
      <label>
        Mode:
        <select id="modeSelect">
          <option value="pvp">Player vs Player</option>
          <option value="ai">Player vs AI</option>
          <option value="online" disabled>Online PvP – Coming Soon</option>
        </select>
      </label>

      <label>
        Difficulty:
        <input type="range" id="aiLevel" min="1" max="20" value="5" />
      </label>

      <label>
        Timer:
        <select id="timerSelect">
          <option value="0">No Timer</option>
          <option value="10" selected>10 Minutes</option>
          <option value="20">20 Minutes</option>
          <option value="30">30 Minutes</option>
        </select>
      </label>

      <label>
        <input type="checkbox" id="speechToggle" />
        Enable Move Speech
      </label>

      <button id="startGameBtn"><i data-lucide="play"></i> Start Game</button>
    </div>

    <!-- Main Game Section -->
    <div id="boardWrapper" style="display:none;">
      <div id="board">
        <!-- Coordinate Labels -->
        <!-- Ranks (1–8) -->
        ${[...Array(8)].map((_, i) =>
          `<div class="board-label rank-label" style="top: ${12.5 * i}%;">${8 - i}</div>`).join('')}
        <!-- Files (a–h) -->
        ${[...Array(8)].map((_, i) =>
          `<div class="board-label file-label" style="left: ${12.5 * i}%;">${String.fromCharCode(97 + i)}</div>`).join('')}
      </div>

      <!-- Info + Timer -->
      <div id="info">
        <div id="timers">
          <div class="timer white"><i data-lucide="clock"></i> White: <span id="whiteTimer">10:00</span></div>
          <div class="timer black"><i data-lucide="clock"></i> Black: <span id="blackTimer">10:00</span></div>
        </div>
        <p>Status: <span id="status">Ready</span></p>
      </div>

      <!-- Move History -->
      <ol id="moveList"></ol>
    </div>
  </div>

  <!-- Compact 3-dot Menu Modal -->
  <div id="menuModal">
    <button id="exportBtn"><i data-lucide="download"></i> Export PGN</button>
    <button id="importBtn"><i data-lucide="upload"></i> Import PGN</button>
    <button id="toggleHistoryBtn"><i data-lucide="scroll"></i> Toggle History</button>
    <label>
      <input type="checkbox" id="speechToggleMenu" />
      <i data-lucide="mic"></i> Move Speech
    </label>
  </div>

  <!-- Winner Modal -->
  <div id="winnerModal">
    <h2 id="winnerText">Checkmate!</h2>
    <button onclick="newGame()">
      <i data-lucide="rotate-ccw"></i> Play Again
    </button>
  </div>

  <!-- ✅ Chess.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

  <!-- ✅ Stockfish as Web Worker -->
  <script>
    window.stockfish = new Worker("stockfish.js");
  </script>

  <!-- ✅ Main Logic -->
  <script src="app.js"></script>

  <!-- ✅ Activate Lucide icons after DOM -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();
      // Sync speech checkbox in menu
      const speechToggleMenu = document.getElementById("speechToggleMenu");
      const speechToggle = document.getElementById("speechToggle");
      speechToggleMenu.addEventListener("change", () => {
        speechToggle.checked = speechToggleMenu.checked;
      });
      speechToggle.addEventListener("change", () => {
        speechToggleMenu.checked = speechToggle.checked;
      });
    });
  </script>
</body>
</html>
